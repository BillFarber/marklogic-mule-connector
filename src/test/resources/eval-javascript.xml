<mule xmlns="http://www.mulesoft.org/schema/mule/core"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xmlns:marklogic="http://www.mulesoft.org/schema/mule/marklogic"
      xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
        http://www.mulesoft.org/schema/mule/marklogic http://www.mulesoft.org/schema/mule/marklogic/current/mule-marklogic.xsd">

  <marklogic:config name="config" configId="configId">
    <marklogic:connection
        host="localhost"
        port="8022"
        username="mule2-test-user"
        password="password"
        authenticationType="DIGEST"/>
  </marklogic:config>

  <flow name="simple-math">
    <marklogic:eval-javascript config-ref="config">
      <marklogic:script><![CDATA[1 + 2;]]></marklogic:script>
    </marklogic:eval-javascript>
  </flow>

  <flow name="writeAndDeleteDocument">
    <marklogic:read-document config-ref="config" uri="/metadataSamples/json/hello.json"/>
    <marklogic:write-document config-ref="config" uriPrefix='/toBeDeleted' uriSuffix=".json" generateUUID="False"
                          permissions="rest-reader,read,rest-reader,update"/>
    <marklogic:read-document config-ref="config" uri="/toBeDeleted.json"/>
  </flow>

  <flow name="deleteDocument">
    <marklogic:eval-javascript config-ref="config">
      <marklogic:script><![CDATA[declareUpdate(); xdmp.documentDelete("/toBeDeleted.json")]]></marklogic:script>
    </marklogic:eval-javascript>
  </flow>

  <flow name="readDocumentThatShouldHaveBeenDeleted">
    <marklogic:read-document config-ref="config" uri="/toBeDeleted.json"/>
  </flow>

</mule>
